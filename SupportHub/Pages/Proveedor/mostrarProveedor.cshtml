@page
@model SupportHub.Pages.Proveedor.mostrarProveedorModel
@{
    ViewData["Title"] = "Proveedores";
    Layout = "_Layout";
}
<br />

<link rel="stylesheet" href="~/css/estiloPantallas.css">

<div class="content-wrapper" style="max-width: 1300px; border-radius: 20px;">
    <h1>Gestión de Proveedores</h1>

    <div class="row mb-3">
        <div class="col-md-8">
            <div class="search-bar d-flex">
                <input type="text" class="form-control me-2" placeholder="Buscar por código o nombre de proveedor...">
                <button class="btn"><i class="fas fa-search"></i>Buscar</button>
            </div>
        </div>
        <div class="col-md-4 text-end">
            <button class="btn btn-add"><i class="fas fa-plus-circle"></i>Agregar Proveedor</button>
        </div>
    </div>

    <div>
        <table class="table table-hover align-middle text-center" style="max-width: 1300px; width: 100%;">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all"></th>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Dirección</th>
                    <th>Teléfono</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.listaProveedor)
                {
                    <tr>
                        <td><input type="checkbox" class="select-checkbox"></td>
                        <td align="left">@item.codProveedor</td>
                        <td align="left">@item.nombreProveedor</td>
                        <td align="left">@item.direccionProveedor</td>
                        <td align="left">@item.telefonoProveedor</td>
                        <td>
                            <button class="btn btn-edit"><i class="fas fa-pen"></i>Modificar</button>
                            <button class="btn btn-delete" data-id="@item.idProveedor"><i class="fas fa-trash"></i>Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Botón para eliminar seleccionados -->
    <button id="btn-eliminar-seleccionados" class="btn btn-delete">
        <i class="fas fa-trash"></i>
    </button>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Manejar con clic en el botón de eliminar para eliminar un proveedor específico
        document.querySelectorAll(".btn-delete").forEach(function (button) {
            button.addEventListener("click", function () {
                var idProveedor = this.getAttribute("data-id");
                if (confirm("¿Estás seguro de que deseas eliminar este proveedor?")) {
                    fetch('/Proveedor/mostrarProveedor?idProveedor=' + idProveedor, {
                        method: 'POST'
                    })
                    .then(response => {
                        if (response.ok) {
                            alert("Proveedor eliminado exitosamente.");
                            location.reload(); // Recargar página después de eliminar elemento
                        } else {
                            alert("Error al eliminar el proveedor.");
                        }
                    })
                    .catch(error => {
                        console.error('Error al realizar la solicitud:', error);
                        alert("Error al eliminar el proveedor.");
                    });
                }
            });
        });

        // Manejar la eliminación de proveedores seleccionados
        document.getElementById("btn-eliminar-seleccionados").addEventListener("click", function () {
            var checkboxes = document.querySelectorAll(".select-checkbox:checked");
            var ids = Array.from(checkboxes).map(checkbox => checkbox.closest('tr').querySelector('.btn-delete').getAttribute('data-id'));

            if (ids.length === 0) {
                alert("Por favor, selecciona al menos un proveedor para eliminar.");
                return;
            }

            if (confirm("¿Estás seguro de que deseas eliminar los proveedores seleccionados?")) {
                Promise.all(ids.map(idProveedor =>
                    fetch('/Proveedor/mostrarProveedor?idProveedor=' + idProveedor, { method: 'POST' })
                ))
                .then(responses => {
                    if (responses.every(response => response.ok)) {
                        alert("Proveedores eliminados exitosamente.");
                        location.reload();
                    } else {
                        alert("Error al eliminar algunos proveedores.");
                    }
                })
                .catch(error => {
                    console.error('Error al realizar la solicitud:', error);
                    alert("Error al eliminar algunos proveedores.");
                });
            }
        });

        // Seleccionar/Deseleccionar todos los proveedores
        document.getElementById("select-all").addEventListener("click", function () {
            var checkboxes = document.querySelectorAll(".select-checkbox");
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });
    });
</script>
